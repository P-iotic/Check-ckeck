<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="UTF-8" />
  <title>ForgeWorks â€” Reports</title>
  <link rel="stylesheet" href="styles.css" />
  <!-- Add these CDN links -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    /* Reports specific styles */
    .reports-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .report-filters {
      background: var(--panel);
      padding: 1.5rem;
      border-radius: 10px;
      margin-bottom: 2rem;
      border: 1px solid var(--border);
    }
    
    .filter-row {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    
    .filter-group {
      flex: 1;
      min-width: 200px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .stat-card {
      background: var(--panel);
      padding: 1.5rem;
      border-radius: 10px;
      text-align: center;
      border: 1px solid var(--border);
    }
    
    .stat-value {
      font-size: 2.5rem;
      font-weight: 700;
      margin: 0.5rem 0;
      color: var(--accent);
    }
    
    .stat-label {
      color: var(--muted);
      font-size: 0.9rem;
    }
    
    .chart-container {
      background: var(--panel);
      padding: 1.5rem;
      border-radius: 10px;
      margin-bottom: 2rem;
      border: 1px solid var(--border);
    }
    
    .chart-title {
      margin-top: 0;
      margin-bottom: 1.5rem;
      color: var(--text);
    }
    
    .report-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 2rem;
    }
    
    .report-table th {
      background: var(--panel);
      padding: 1rem;
      text-align: left;
      border-bottom: 2px solid var(--border);
    }
    
    .report-table td {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--border);
    }
    
    .report-table tr:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    
    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .status-pending {
      background-color: #ffc107;
      color: #000;
    }
    
    .status-processing {
      background-color: #17a2b8;
      color: #fff;
    }
    
    .status-shipped {
      background-color: #007bff;
      color: #fff;
    }
    
    .status-delivered {
      background-color: #28a745;
      color: #fff;
    }
    
    .status-cancelled {
      background-color: #dc3545;
      color: #fff;
    }
    
    .export-options {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .pagination {
      display: flex;
      justify-content: center;
      margin-top: 2rem;
      gap: 0.5rem;
    }
    
    .page-btn {
      padding: 0.5rem 1rem;
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--text);
      border-radius: 5px;
      cursor: pointer;
    }
    
    .page-btn.active {
      background: var(--accent);
      color: #000;
      border-color: var(--accent);
    }
    
    .page-btn:hover:not(.active) {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .no-data {
      text-align: center;
      padding: 2rem;
      color: var(--muted);
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="header-inner">
      <div class="brand">ForgeWorks Admin</div>
      <nav class="topnav">
        <a href="index.html">Products</a>
        <a href="admin.html" data-role="admin">Admin</a>
      </nav>
    </div>
  </header>

  <div id="userIcon"></div>

  <main class="container">
    <div class="reports-header">
      <h2>Sales Reports</h2>
      <div class="export-options">
        <button class="button-primary" id="exportPdfBtn">Export as PDF</button>
        <button class="button-primary" id="exportCsvBtn">Export as CSV</button>
      </div>
    </div>

    <div class="report-filters">
      <h3>Filter Reports</h3>
      <div class="filter-row">
        <div class="filter-group">
          <label>Date Range</label>
          <select id="dateRange" class="input">
            <option value="7">Last 7 Days</option>
            <option value="30" selected>Last 30 Days</option>
            <option value="90">Last 90 Days</option>
            <option value="365">Last Year</option>
            <option value="custom">Custom Range</option>
          </select>
        </div>
        <div class="filter-group" id="customDateRange" style="display: none;">
          <label>Custom Range</label>
          <div style="display: flex; gap: 0.5rem;">
            <input type="date" id="startDate" class="input">
            <input type="date" id="endDate" class="input">
          </div>
        </div>
        <div class="filter-group">
          <label>Status</label>
          <select id="statusFilter" class="input">
            <option value="">All Statuses</option>
            <option value="Pending">Pending</option>
            <option value="Processing">Processing</option>
            <option value="Shipped">Shipped</option>
            <option value="Delivered">Delivered</option>
            <option value="Cancelled">Cancelled</option>
          </select>
        </div>
      </div>
      <div class="filter-row">
        <div class="filter-group">
          <label>Product Category</label>
          <select id="categoryFilter" class="input">
            <option value="">All Categories</option>
            <!-- Will be populated dynamically -->
          </select>
        </div>
        <div class="filter-group">
          <label>Customer</label>
          <select id="customerFilter" class="input">
            <option value="">All Customers</option>
            <!-- Will be populated dynamically -->
          </select>
        </div>
        <div class="filter-group">
          <label style="opacity: 0;">Apply</label>
          <button class="button-primary" id="applyFilters">Apply Filters</button>
        </div>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Total Revenue</div>
        <div class="stat-value" id="totalRevenue">R 0.00</div>
        <div class="stat-change" id="revenueChange">0% vs previous period</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Total Orders</div>
        <div class="stat-value" id="totalOrders">0</div>
        <div class="stat-change" id="ordersChange">0% vs previous period</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Average Order Value</div>
        <div class="stat-value" id="avgOrderValue">R 0.00</div>
        <div class="stat-change" id="aovChange">0% vs previous period</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Conversion Rate</div>
        <div class="stat-value" id="conversionRate">0%</div>
        <div class="stat-change" id="conversionChange">0% vs previous period</div>
      </div>
    </div>

    <div class="chart-container">
      <h3 class="chart-title">Revenue Trend</h3>
      <canvas id="revenueChart" height="300"></canvas>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
      <div class="chart-container">
        <h3 class="chart-title">Sales by Category</h3>
        <canvas id="categoryChart" height="250"></canvas>
      </div>
      <div class="chart-container">
        <h3 class="chart-title">Order Status Distribution</h3>
        <canvas id="statusChart" height="250"></canvas>
      </div>
    </div>

    <h3>Order Details</h3>
    <div class="table-wrap">
      <table class="report-table" id="ordersTable">
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Date</th>
            <th>Customer</th>
            <th>Products</th>
            <th>Amount</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="ordersTableBody">
          <tr>
            <td colspan="6" class="no-data">Loading order data...</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="pagination" id="pagination">
      <button class="page-btn" id="prevPage">Previous</button>
      <span id="pageInfo">Page 1 of 1</span>
      <button class="page-btn" id="nextPage">Next</button>
    </div>
  </main>

  <div id="toast"></div>
  <div id="spinnerOverlay"><div class="spinner"></div></div>

  <script src="script.js"></script>
  <script>
    //Initialize when page loads
    document.addEventListener('DOMContentLoaded', function() {
   /*   const user = JSON.parse(localStorage.getItem("fw_user") || "{}");
    if (!user.id || user.role !== 'admin') {
      showToast("Admin access required");
      window.location.href = "login.html";
      return;
    }*/
      initUserIcon();
      initCartIcon();
      bootstrapData();
      initReportsPage();
    });
  </script>
</body>
</html>